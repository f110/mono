-- This file generated by protoc-ddl.
-- Generated by MySQL Generator (v0.1)

SET foreign_key_checks=0;

DROP TABLE IF EXISTS `source_repository`;
CREATE TABLE `source_repository` (
	`id` INTEGER NOT NULL AUTO_INCREMENT,
	`url` VARCHAR(255) NOT NULL,
	`clone_url` VARCHAR(255) NOT NULL,
	`name` VARCHAR(100) NOT NULL,
	`private` TINYINT(1) NOT NULL,
	`status` INTEGER UNSIGNED NOT NULL,
	`default_branch` VARCHAR(255) NOT NULL,
	`created_at` DATETIME NOT NULL,
	`updated_at` DATETIME NULL,
	PRIMARY KEY(`id`)
) Engine=InnoDB;

DROP TABLE IF EXISTS `task`;
CREATE TABLE `task` (
	`id` INTEGER NOT NULL AUTO_INCREMENT,
	`repository_id` INTEGER NOT NULL,
	`job_name` VARCHAR(255) NOT NULL,
	`job_configuration` TEXT NULL,
	`parsed_job_configuration` BLOB NOT NULL,
	`revision` VARCHAR(255) NOT NULL,
	`is_trunk` TINYINT(1) NOT NULL,
	`bazel_version` VARCHAR(255) NOT NULL,
	`success` TINYINT(1) NOT NULL,
	`log_file` VARCHAR(255) NOT NULL,
	`command` VARCHAR(255) NOT NULL,
	`target` VARCHAR(255) NOT NULL,
	`targets` TEXT NOT NULL,
	`platform` TEXT NOT NULL,
	`via` VARCHAR(255) NOT NULL,
	`config_name` VARCHAR(255) NOT NULL,
	`node` VARCHAR(255) NOT NULL,
	`manifest` TEXT NOT NULL,
	`container` VARCHAR(255) NOT NULL,
	`executed_tests_count` INTEGER NOT NULL,
	`succeeded_tests_count` INTEGER NOT NULL,
	`start_at` DATETIME NULL,
	`finished_at` DATETIME NULL,
	`created_at` DATETIME NOT NULL,
	`updated_at` DATETIME NULL,
	INDEX `idx_repo` (`repository_id`),
	PRIMARY KEY(`id`)
) Engine=InnoDB;

DROP TABLE IF EXISTS `trusted_user`;
CREATE TABLE `trusted_user` (
	`id` INTEGER NOT NULL AUTO_INCREMENT,
	`github_id` BIGINT NOT NULL,
	`username` VARCHAR(255) NOT NULL,
	`created_at` DATETIME NOT NULL,
	`updated_at` DATETIME NULL,
	PRIMARY KEY(`id`)
) Engine=InnoDB;

DROP TABLE IF EXISTS `permit_pull_request`;
CREATE TABLE `permit_pull_request` (
	`id` INTEGER NOT NULL AUTO_INCREMENT,
	`repository` VARCHAR(255) NOT NULL,
	`number` INTEGER NOT NULL,
	`created_at` DATETIME NOT NULL,
	`updated_at` DATETIME NULL,
	PRIMARY KEY(`id`)
) Engine=InnoDB;

DROP TABLE IF EXISTS `test_report`;
CREATE TABLE `test_report` (
	`id` INTEGER NOT NULL AUTO_INCREMENT,
	`repository_id` INTEGER NOT NULL,
	`task_id` INTEGER NOT NULL,
	`label` VARCHAR(255) NOT NULL,
	`status` INTEGER UNSIGNED NOT NULL,
	`duration` BIGINT NOT NULL,
	`start_at` DATETIME NOT NULL,
	INDEX `idx_label` (`label`),
	INDEX `idx_task_id` (`task_id`),
	PRIMARY KEY(`id`)
) Engine=InnoDB;

DROP TABLE IF EXISTS `job`;
CREATE TABLE `job` (
	`repository_id` INTEGER NOT NULL,
	`name` VARCHAR(255) NOT NULL,
	PRIMARY KEY(`repository_id`,`name`)
) Engine=InnoDB;

SET foreign_key_checks=1;
